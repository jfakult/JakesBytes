"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),function(){var a=function(t,e){var t;this._data=$.extend(!0,{},t),(this._sharedGroup=e)?(t=this.getTopLevelGroupName(),e.getName()!==t&&(this._data.group=e.getName()+this._data.group.substring(t.length))):!this.useSharePrefix()&&this._data.group&&0===this._data.group.indexOf(this.SHARED_FOLDER_NAME_PREFIX)&&(this._data.group=this._data.group.substring(this.SHARED_FOLDER_NAME_PREFIX.length))};(VaultItemBase=function(t,e){this._views=[],a.apply(this,arguments)}).prototype.refresh=function(t,e){return a.apply(this,arguments),this}}(),VaultItemBase.prototype.defaultFields=function(t,e){for(var a in e=e||this._data,t)void 0===e[a]&&(e[a]=t[a])},VaultItemBase.prototype.SHARED_FOLDER_NAME_PREFIX="Shared-",VaultItemBase.prototype.useSharePrefix=function(){var t;return!!this.getSharedGroup()&&this._sharedGroup.useSharePrefix()},VaultItemBase.prototype.getTopLevelGroupName=function(){var t=this._data.group||"",e=t.indexOf("\\");return-1<(e=this.getSharedGroup()instanceof LinkedSharedGroup?t.indexOf("\\",e+1):e)?t.substring(0,e):t},(VaultItem=function(){var a={pwprotect:!1},t;return function(t,e){VaultItemBase.call(this,t,e),this.defaultFields(a)}}()).prototype=Object.create(VaultItemBase.prototype),VaultItem.prototype.constructor=VaultItem,(AccountBase=function(){var a={action:"",aid:"0",basic_auth:"0",captcha_id:"",custom_js:"",extra:"",fields:[],group:"",fiid:"",genpw:!1,individualshare:!1,last_touch:"0",method:"",newvalues:[],realm_data:"",sharedfromuid:"",submit_id:"",urid:"0",fav:"0",username:"",password:"",totp:""},t;return function(t,e){VaultItem.call(this,t,e),this.defaultFields(a)}}()).prototype=Object.create(VaultItem.prototype),AccountBase.prototype.constructor=AccountBase,(AccountBaseWithFields=function(t,e){AccountBase.call(this,t,e)}).prototype=Object.create(AccountBase.prototype),AccountBaseWithFields.prototype.constructor=AccountBaseWithFields,(Account=function(t,e){AccountBaseWithFields.call(this,t,e),this._data.sn=0}).prototype=Object.create(AccountBaseWithFields.prototype),(Account.prototype.constructor=Account).prototype.getDisplayClass=function(){return"Cloud Apps"===this.getRecordType()?CloudAppDisplay:AccountDisplay},Account.prototype.TYPE="Account",Account.prototype.TYPEPASSKEY="Passkey",Account.prototype.getRecordType=function(){return LPFeatures.cloud_apps_filter_in_vault()&&void 0!==this._data.aid&&"string"==typeof this._data.aid&&"sso_"===this._data.aid.substr(0,4)?"Cloud Apps":"http://passkey"===this._data.url?Account.prototype.TYPEPASSKEY:Account.prototype.TYPE},(AuroraAccount=function(t,e){Account.call(this,t,e),this.currentSearch={searchToken:null,matchSource:null,searchTextLength:null}}).prototype=Object.create(Account.prototype),(AuroraAccount.prototype.constructor=AuroraAccount).prototype.getDisplayClass=function(){return AuroraAccountDisplay},(Group=function(t,e){AccountBase.call(this,t,e),this._data.url="http://group"}).prototype=Object.create(AccountBase.prototype),(Group.prototype.constructor=Group).prototype.getDisplayClass=function(){return GroupDisplay},Group.prototype.TYPE="Group",(DummyGroup=function(t,e){Group.call(this,{group:t},e)}).prototype=Object.create(Group.prototype),(DummyGroup.prototype.constructor=DummyGroup).prototype.destruct=function(){this._views.forEach(function(t){"function"==typeof t.destruct&&t.destruct()})},DummyGroup.prototype.getDisplayClass=function(){return DummyGroupDisplay},(DefaultGroup=function(t){DummyGroup.call(this,t)}).prototype=Object.create(DummyGroup.prototype),(DefaultGroup.prototype.constructor=DefaultGroup).prototype.getDisplayClass=function(){return DefaultGroupDisplay},function(){var o={accepted:"1",association:"0",associative:"0",can_administer:"1",cgid:"0",deleted:"0",download:"1",give:"1",id:"0",invisible:"0",outside_enterprise:"0",readonly:"0",shareid:"0"},a=function(t,e){this.useSharePrefix()&&0!==this._data.group.indexOf(this.SHARED_FOLDER_NAME_PREFIX)&&(this._data.group=this.SHARED_FOLDER_NAME_PREFIX+this._data.group),this._data.group=this.getTopLevelGroupName(),e=$.extend(!0,{},e);var a=LPTools.get_gmt_timestamp();o.create=a,o.last_modified=a,this.defaultFields(o,e),this._shareInfo=e,this._shareInfo.name=this.getShareGroupName(),this._shareInfo.decsharename=this._data.group,this.setID(this._data.aid)};(SharedGroup=function(t,e){Group.call(this,t),a.apply(this,arguments)}).prototype=Object.create(Group.prototype),(SharedGroup.prototype.constructor=SharedGroup).prototype.refresh=function(t,e){return Group.prototype.refresh.call(this,t),a.apply(this,arguments),this}}(),SharedGroup.prototype.getDisplayClass=function(){return SharedGroupDisplay},(LinkedGroup=function(t,e){SharedGroup.call(this,t,e)}).prototype=Object.create(SharedGroup.prototype),(LinkedGroup.prototype.constructor=LinkedGroup).prototype.getDisplayClass=function(){return LinkedGroupDisplay},(LinkedSharedGroup=function(t,e){LinkedGroup.call(this,t,e)}).prototype=Object.create(LinkedGroup.prototype),(LinkedSharedGroup.prototype.constructor=LinkedSharedGroup).prototype.getDisplayClass=function(){return LinkedSharedGroupDisplay},LinkedSharedGroup.prototype.useSharePrefix=function(){return!1},LinkedSharedGroup.prototype.getTopLevelGroupName=function(){return this._data.group},(EmergencyAccessGroup=function(t,e){LinkedGroup.call(this,t,e)}).prototype=Object.create(LinkedGroup.prototype),(EmergencyAccessGroup.prototype.constructor=EmergencyAccessGroup).prototype.getDisplayClass=function(){return EmergencyAccessGroupDisplay},(AuroraGroup=function(t){Group.call(this,t)}).prototype=Object.create(Group.prototype),(AuroraGroup.prototype.constructor=AuroraGroup).prototype.getDisplayClass=function(){return AuroraGroupDisplay},function(){var o=function(t,e,a){this._data.sn=1,this._data.url=t&&t.record?"http://passkey":"http://sn",this._attachments=a||[];for(var o=0,r=this._attachments.length;o<r;++o)this._attachments[o].setParentNote(this)},e=((Note=function(t,e,a){AccountBase.call(this,t,e),o.apply(this,arguments)}).prototype=Object.create(AccountBase.prototype),(Note.prototype.constructor=Note).prototype.refresh=function(t,e,a){return AccountBase.prototype.refresh.apply(this,arguments),o.apply(this,arguments),this},Note.prototype.edit=function(t){return e(this),VaultItemBase.prototype.edit.apply(this,arguments),this},function(t){t._data.individualshare&&t._data.sharedfromaid&&$.ajax({method:"get",url:(bg.get("base_url")||"/")+"lmiapi/shares/"+t._data.aid+"/is-active",success:function(t){t.isShareActive||(Notifications.initialize(),Notifications.displayErrorMessage(Strings.translateString("The owner of this item is no longer sharing it with you.")),top.get_accts())},error:function(){}})})}(),Note.prototype.getDisplayClass=function(){return NoteDisplay},Note.prototype.TYPE="Note";var Passkey=function(t,e){Note.call(this,t,e),this.mapFavFlagFromNewDataModel(t),this.mapGroupFromNewDataModel(t)};Passkey.prototype=Object.create(Note.prototype),(Passkey.prototype.constructor=Passkey).prototype.mapFavFlagFromNewDataModel=function(t){this._data.fav=!0===t.record.favorite?"1":"0"},Passkey.prototype.mapGroupFromNewDataModel=function(t){this._data.group=t.folder,this._data.encgroup=t.record.folder},Passkey.prototype.getDisplayClass=function(){return PasskeyDisplay},Passkey.prototype.getSearchTokens=function(t){var e=[this.getName(),this.getUsername()];return this._data.record.notes&&e.push(LPProxy.decryptMobile(this._data.record.notes,!0,this.getKey())),e},Passkey.prototype.save=function(t,e,a){var o=LPProxy.decryptMobile(t.extra,!0,this.getKey()),i=this.getValuesFromDecryptedExtraLines(o),r;r=this,LPRequest.makeUpdateRequest(function(t,e,a,o,r,s){var n={id:e.id,folder:e.group,loginUrl:i.origin,username:i.username,notes:i.notes,encname:e.encname,name:e.name,fav:e.fav,pwprotect:e.pwprotect};reduxApp.updatePasskeyFromLegacyVault(n).then(function(){r(n)}).catch(function(){s()})},{parameters:[r,t,e,a],success:function(t){r.update(t,e),r.publishSaveSuccess(1)}})},Passkey.prototype.getID=function(){return this._data.id},Passkey.prototype.update=function(t,e){var a=this._data.folder===t.folder||""===this._data.group&&"0"===e._data.aid;this._data.folder=t.folder,this._data.group=t.folder,this._data.origin=t.loginUrl,this._data.username=t.username,this._data.notes=t.extra,this._data.encname=t.encname,this._data.name=t.name,this._data.fav=t.fav,this._data.pwprotect=t.pwprotect,a||this.updateViews(e)},Passkey.prototype.getValuesFromDecryptedExtraLines=function(t){var o,r,e,a,s=(t.split("\n").forEach(function(t,e){var a=t.indexOf(":");"Launch URL"===t.substr(0,a)?o=t.substr(a+1,t.length):"Username"===t.substr(0,a)&&(r=t.substr(a+1,t.length))}),"Notes:"),e=t.indexOf(s),e=0<=e?t.substring(e+s.length,t.length).replaceAll("\\n","\n"):"";return{origin:o,username:r,notes:e}},Passkey.prototype.edit=function(t){this._data.record=reduxApp.getState().vaultData.passkeys[this.getID()].record;var e=LPProxy.decryptMobile(this._data.record.passkey,!0,this.getKey()),e=JSON.parse(e),a=this,o=LPProxy.decryptMobile(this._data.record.notes,!0,this.getKey()),r="NoteType:Passkey\n",r=(r=(r+="RP ID:"+e.rpId+"\n")+("Launch URL:"+e.origin+"\n"))+("Username:"+e.username+"\n")+("Notes:"+o+"\n");return t.itemsForAction.find(function(t){a._data.id===t._data.id&&(t._data.extra=LPProxy.encryptMobile(r,!0,a.getKey()))}),VaultItemBase.prototype.edit.apply(this,arguments),this},Passkey.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_COPY_USERNAME:this.copyUsername();break;case Constants.ACTION_COPY_URL:this.copyURL();break;case Constants.ACTION_LAUNCH:this.launch(e);break;case Constants.ACTION_GO_TO_URL:this.goToURL();break;default:AccountBase.prototype.handleClickEvent.apply(this,arguments)}},Passkey.prototype.getUsername=function(){return this._data.username},Passkey.prototype.launch=function(t){this.passwordProtect(function(){LPProxy.launchSite(this,t)},{types:"login_site_prompt"})},Passkey.prototype.getNoteType=function(){return"Passkey"},Passkey.prototype.getFormData=function(t){var e=VaultItem.prototype.getFormData.apply(this,arguments);return e.extra=this.getKeyValuePairs(t.extra),e.notetype=this.getNoteType(),e.template=this._data.template,e.pwprotect=this._data.record.passwordProtected,e},Passkey.prototype.isSharingEnabled=function(){return!1},Passkey.prototype.isURLLaunchable=function(){return void 0!==this._data.loginUrl&&(0===this._data.loginUrl.indexOf("http://")||0===this._data.loginUrl.indexOf("https://"))},Passkey.prototype.getURL=function(){return this._data.loginUrl},Passkey.prototype.copyURL=function(){LPProxy.copyURL(this)},Passkey.prototype.goToURL=function(){LPProxy.goToURL(this)},Passkey.prototype.getShareType=function(){return"none"},Passkey.prototype.TYPE="Passkey",(FormFill=function(){var a={address1:"",address2:"",address3:"",bankacctnum:"",bankname:"",bankroutingnum:"",birthday:"",cccsc:"",ccexp:"",ccissuenum:"",ccname:"",ccnum:"",ccstart:"",city:"",company:"",country:"",country_cc3l:"",country_name:"",county:"",creditmon:"",customfield1alttext:"",customfield1cfid:"0",customfield1text:"",customfield1value:"",customfield2alttext:"",customfield2cfid:"0",customfield2text:"",customfield2value:"",customfield3alttext:"",customfield3cfid:"0",customfield3text:"",customfield3value:"",deleteext:0,driverlicensenum:"",email:"",eveext:"",evephone:"",evephone3lcc:"",fax:"",fax3lcc:"",faxext:"",ffid:0,firstname:"",firstname2:"",firstname3:"",gender:"",group:"",lastname:"",lastname2:"",lastname3:"",middlename:"",mobileemail:"",mobileext:"",mobilephone:"",mobilephone3lcc:"",notes:"",phone:"",phone3lcc:"",phoneext:"",profilelanguage:"",profilename:"",profiletype:0,ssn:"",state:"",state_name:"",taxid:"",timezone:"",title:"",username:"",zip:""},t;return function(t,e){VaultItem.call(this,t,e),this.defaultFields(a),void 0===this._data.decprofilename&&(this._data.decprofilename=LPProxy.decryptMobile(this._data.profilename,!0,this.getKey()))}}()).prototype=Object.create(VaultItem.prototype),(FormFill.prototype.constructor=FormFill).prototype.getDisplayClass=function(){return FormFillDisplay},FormFill.prototype.TYPE="FormFill",FormFill.prototype.getRecordType=function(){return FormFill.prototype.TYPE},(Attachment=function(t){VaultItemBase.call(this,t),this._filename=null}).prototype=Object.create(VaultItemBase.prototype),(Attachment.prototype.constructor=Attachment).prototype.getDisplayClass=function(){return AttachmentDisplay},(Identity=function(t){VaultItemBase.call(this,t),this.defaultFields({iid:"0"}),this._enabled=!1,void 0===this._data.deciname&&(this._data.deciname=LPProxy.decrypt(this._data.iname,this.getKey()))}).prototype=Object.create(VaultItemBase.prototype),(Identity.prototype.constructor=Identity).prototype.getDisplayClass=function(){return IdentityDisplay},(AllIdentity=function(){Identity.call(this),this._data.deciname=Strings.translateString("All"),this._data.iid=""}).prototype=Object.create(Identity.prototype),(AllIdentity.prototype.constructor=AllIdentity).prototype.getDisplayClass=function(){return AllIdentityDisplay},(Application=function(){var a={appaid:"0"},t;return function(t,e){AccountBaseWithFields.call(this,t,e),this.defaultFields(a),this.setSaveAll()}}()).prototype=Object.create(AccountBaseWithFields.prototype),Application.prototype.constructor=AccountBaseWithFields,Application.prototype.getDisplayClass=function(){return ApplicationDisplay},Application.prototype.getRecordType=function(){return Application.prototype.TYPE},Application.prototype.TYPE="Application",function(n,G,h,g){var r,s,e,o,a,i,p,c,u,l,d,y,f,t,m,_,S,v,V,I,A,T,E,b,P,B,U,M,N,R,D,x,Y,K,C,q,W,H,j,O,F,z,J,X,k,w,L,$,Z,Q,tt;r=function(t,e,a){return e<t?a?1:-1:t<e?a?-1:1:0},VaultItemBase.prototype.getRecordType=function(){return null},VaultItemBase.prototype.sortByFunction=function(t,e,a,o){var t=t[a].apply(t),a=e[a].apply(e);return r(t,a,o)},VaultItemBase.prototype.sortByTextFunction=(s=function(t,e){var e=t[e].apply(t);return"string"==typeof e?e.toLowerCase():""},function(t,e,a,o){return r(s(t,a),s(e,a),o)}),VaultItemBase.prototype.sortByNameAsc=function(t,e){return VaultItemBase.prototype.sortByTextFunction(t,e,"getName",!0)},VaultItemBase.prototype.sortByNameDesc=function(t,e){return VaultItemBase.prototype.sortByTextFunction(t,e,"getName",!1)},VaultItemBase.prototype.lockForUpdate=function(){for(var t=0,e=this._views.length;t<e;++t)this._views[t].lockForUpdate()},VaultItemBase.prototype.unlock=function(){for(var t=0,e=this._views.length;t<e;++t)this._views[t].unlock()},VaultItemBase.prototype.updateViews=function(t,e){for(var a=this._views.slice(),o=0,r=a.length;o<r;++o)a[o].updateView(t,e)},VaultItemBase.prototype.destroyViews=function(){for(var t=this._views.slice(),e=0,a=t.length;e<a;++e)t[e].destruct();this._views=[]},VaultItemBase.prototype.newDisplayObject=function(){var t;return new(this.getDisplayClass())(this)},VaultItemBase.prototype.addView=function(t){this._views.push(t)},VaultItemBase.prototype.removeView=function(t){if(this._views)for(var e=0,a=this._views.length;e<a;++e)if(this._views[e]===t){this._views.splice(e,1);break}},VaultItemBase.prototype.isNew=function(){return"0"===this.getID()},VaultItemBase.prototype.createHandler=function(t){var e=this;if(1<arguments.length){for(var a=[],o=1,r=arguments.length;o<r;++o)a.push(arguments[o]);return function(){t.apply(e,a)}}return function(){t.apply(e,arguments)}},VaultItemBase.prototype.update=function(t,e,a){var t,o,t,o,e;g.removeItem(this),t&&(this._data=t),g.addItem(this),this._sharedGroup=e?e.getSharedGroup():null,h.getOption(a,"updateViews",!0)&&(t=null,Array.isArray(this._views)&&(t=(o=this._views[0])&&o._parent?o._parent._model:null),this.updateViews(e,a),bg.get("g_nofolder_feature_enabled"))&&t&&t._data&&t._views&&(o=t._data.group===Strings.Consts.NONE_GROUP,e=0===t._views.length,o)&&e&&g.removeItem(t)},VaultItemBase.prototype.deleteUpdates=function(t){void 0!==t&&!t||this.publishDeleteSuccess(1);var t=Array.isArray(this._views)&&this._views[0]&&this._views[0]._parent?this._views[0]._parent._model:null,e,a;this.destroyViews(),g.removeItem(this),Topics.get(Topics.ITEM_REMOVED).publish(),bg.get("g_nofolder_feature_enabled")&&t&&t._data&&t._views&&(e=t._data.group===Strings.Consts.NONE_GROUP,a=0===t._views.length,e)&&a&&g.removeItem(t)},VaultItemBase.prototype.getRepromptType=function(){return null},VaultItemBase.prototype.publishAdd=function(t,e,a){g.addItem(this),this.publishAddSuccess(1),Topics.get(t).publish(this,e,a)},VaultItemBase.prototype.getSuccessfulAddMessage=function(t){return 1<t?Strings.translateString("%d items were added.",t):Strings.translateString("%s was added.",this.toString())},VaultItemBase.prototype.getSuccessfulDeleteMessage=function(t){return 1<t?Strings.translateString("%d items were deleted.",t):Strings.translateString("%s was deleted.",this.toString())},VaultItemBase.prototype.getSuccessfulDeleteMessage=function(t){return 1<t?Strings.translateString("%d items were deleted.",t):Strings.translateString("%s was deleted.",this.toString())},VaultItemBase.prototype.getSuccessfulRestoreMessage=function(t){return 1<t?Strings.translateString("%d items were restored.",t):Strings.translateString("%s was restored.",this.toString())},VaultItemBase.prototype.getSuccessfulRenameMessage=function(t){return 1<t?Strings.translateString("%d items were renamed.",t):Strings.translateString("%s was renamed.",this.toString())},VaultItemBase.prototype.getSuccessfulRemoveMessage=function(t){return 1<t?Strings.translateString("%d items were removed.",t):Strings.translateString("%s was removed.",this.toString())},VaultItemBase.prototype.getSuccessfulSaveMessage=function(t){return 1<t?Strings.translateString("%d items were saved.",t):Strings.translateString("%s was saved.",this.toString())},VaultItemBase.prototype.getSuccessfulPurgeMessage=function(t){return 1<t?Strings.translateString("%d items were purged.",t):Strings.translateString("%s was purged.",this.toString())},VaultItemBase.prototype.getSuccessfulMoveMessage=function(t,e){return 1<t?Strings.translateString("%d items were moved to %s.",t,e):Strings.translateString("%s was moved to %s.",this.toString(),e)},VaultItemBase.prototype.getSuccessfulOrganizeMessage=function(t,e){return 1<t?Strings.translateString("%d items were organized to %s.",t,e):Strings.translateString("%s was organized to %s.",this.toString(),e)},VaultItemBase.prototype.getSuccessfulAddToFavoritesMessage=function(t){return 1<t?Strings.translateString("%d items were added to Favorites.",t):Strings.translateString("%s was added to Favorites.",this.toString())},VaultItemBase.prototype.publishAddSuccess=function(t){Topics.get(Topics.SUCCESS).publish(this.getSuccessfulAddMessage(t))},VaultItemBase.prototype.publishDeleteSuccess=function(t){Topics.get(Topics.SUCCESS).publish(this.getSuccessfulDeleteMessage(t))},VaultItemBase.prototype.publishRenameSuccess=function(t){Topics.get(Topics.SUCCESS).publish(this.getSuccessfulRenameMessage(t))},VaultItemBase.prototype.publishRemoveSuccess=function(t){Topics.get(Topics.SUCCESS).publish(this.getSuccessfulRemoveMessage(t))},VaultItemBase.prototype.publishRestoreSuccess=function(t){Topics.get(Topics.SUCCESS).publish(this.getSuccessfulRestoreMessage(t))},VaultItemBase.prototype.publishSaveSuccess=function(t){Topics.get(Topics.SUCCESS).publish(this.getSuccessfulSaveMessage(t))},VaultItemBase.prototype.publishPurgeSuccess=function(t){Topics.get(Topics.SUCCESS).publish(this.getSuccessfulPurgeMessage(t))},VaultItemBase.prototype.publishMoveSuccess=function(t,e){Topics.get(Topics.SUCCESS).publish(this.getSuccessfulMoveMessage(t,e))},VaultItemBase.prototype.publishOrganizeSuccess=function(t,e){Topics.get(Topics.SUCCESS).publish(this.getSuccessfulOrganizeMessage(t,e))},VaultItemBase.prototype.publishAddToFavoritesSuccess=function(t){Topics.get(Topics.SUCCESS).publish(this.getSuccessfulAddToFavoritesMessage(t))},VaultItemBase.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_EDIT:this.edit(e);break;case Constants.ACTION_DELETE:this.deleteItem(e);break;case Constants.ACTION_PURGE:this.purge(e);break;case Constants.ACTION_RESTORE:this.restore(e);break;case Constants.ACTION_MOVE_TO_FOLDER:this.moveToFolder(e.group,e.itemsForAction,e)}},VaultItemBase.prototype.isShared=function(){var t=this.getSharedGroup();return t&&!(t instanceof LinkedGroup)},VaultItemBase.prototype.shouldPasswordProtectShare=function(){return!0},VaultItemBase.prototype.passwordProtect=function(t,e){for(var a=h.getOption(e,"itemsForAction",[this]),o=!1,r={},s=0,n=a.length;s<n;++s){var i=a[s];if(i.passwordProtected()){o=!0;break}i.shouldPasswordProtectShare()&&i.isShared()&&(r.switch_f_prompt=!0)}e=e||{},o?delete e.types:e.types=h.getProperties(r).concat(h.getOption(e,"types",[])),this.reprompt(t,e)},VaultItemBase.prototype.reprompt=function(t,e){return g.reprompt(this.createHandler(function(){t.apply(this)}),e)},e=function(t,e){for(var a=t.itemsForAction,o,r=0,s=a.length;r<s;++r){var n=a[r];if(void 0===o)o=n.getShareID();else if(o!==n.getShareID())return void Topics.get(Topics.ERROR).publish(Strings.translateString("Sorry, you cannot perform this operation on a mix of shared and non-shared folders, or multiple shared folders at once."))}e(t,o)},VaultItemBase.prototype.purge=(o=function(t){return 1<t.length?this instanceof Group?Strings.translateString(Strings.VaultDynamic.CONFIRM_PURGE_PLURAL):Strings.translateString(Strings.VaultDynamic.CONFRIM_PURGE_FOLDER):Strings.translateString(Strings.VaultDynamic.CONFIRM_PURGE,t[0].toString())},a=function(t,e){var a=t.itemsForAction;LPRequest.makeUpdateRequest(g.purgeDeletedItems,{parameters:[a,e],success:function(){for(var t=0,e=a.length;t<e;t++)a[t].deleteUpdates(!1);a[0].publishPurgeSuccess(a.length)},confirm:{title:Strings.Vault.PURGE,text:o.call(this,a)}})},function(t){e(t,a)}),VaultItemBase.prototype.restore=(i=function(t){return 1<t.length?this instanceof Group?Strings.translateString(Strings.VaultDynamic.CONFIRM_RESTORE_FOLDER):Strings.translateString(Strings.VaultDynamic.CONFIRM_RESTORE_PLURAL):Strings.translateString(Strings.VaultDynamic.CONFIRM_RESTORE,t[0].toString())},p=function(t,e){var a=t.itemsForAction;LPRequest.makeRequest(g.restoreDeletedItems,{parameters:[a,e],success:function(){for(var t=0,e=a.length;t<e;t++)a[t].deleteUpdates(!1);a[0].publishRestoreSuccess(a.length),g.refreshSites()},confirm:{title:Strings.Vault.RESTORE,text:i.call(this,a)}})},function(t){e(t,p)}),VaultItemBase.prototype.confirmDelete=function(t){for(var e=!1,a=0;a<(t?t.length:0);a++)if(!1!==t[a].isReceivedShare()){e=!0;break}var o=e?"<br/><br/>"+Strings.translateString(Strings.VaultDynamic.DELETE_SHARED):"",r;return t&&1<t.length?{title:Strings.Vault.DELETE,text:Strings.translateString(Strings.VaultDynamic.DELETE_CONFIRM_PLURAL)+o}:(r=this,{title:Strings.Vault.DELETE,text:Strings.translateString(Strings.VaultDynamic.DELETE_CONFIRM_SITE,r.getName())+o})},VaultItemBase.prototype.isDeleted=function(){return"1"===this._data.deleted},VaultItemBase.prototype.getName=function(){var t=this._data.name;return t||""},VaultItemBase.prototype.getURL=function(){return this._data.url},VaultItemBase.prototype.isFavorite=function(){return"1"===this._data.fav},VaultItemBase.prototype.setFavorite=function(t){this._data.fav=t?"1":"0"},VaultItemBase.prototype.processEnteredData=function(t,e,a){for(var o in t){var r=this._data[o];"boolean"!=typeof t[o]||"0"!==r&&"1"!==r||(t[o]=t[o]?"1":"0")}e&&e.getSharedGroup()?t.sharefolderid=e.getShareID():delete t.sharefolderid},VaultItemBase.prototype.saveFromDialog=function(t,e,a){var o=(e||this).getKey();this.processEnteredData(t,e,o,a),t=n.extend({},this._data,t),this.save(t,e,a),this.noFolderTrackingEvent(t)},VaultItemBase.prototype.addFromDialog=function(t,e,a){var o=(e||this).getKey();this.processEnteredData(t,e,o,a),n.extend(this._data,t),this.add(e,a),this.noFolderTrackingEvent(t)},VaultItemBase.prototype.getFormData=function(t){var e={},a;for(a in t){var o="pwprotect"===a||"autologin"===a||"never_autofill"===a||"fav"===a,r=this._data[a];o&&"1"===r?e[a]=!0:o&&"0"===r?e[a]=!1:void 0!==r&&"object"!=typeof r&&(e[a]=r)}return e},VaultItemBase.prototype.getKey=function(){var t=this.getSharedGroup();return t?t.getKey():g.getLocalKey()},VaultItemBase.prototype.getShareID=function(){var t=this.getSharedGroup();return t?t.getID():this._data.sharefolderid||""},VaultItemBase.prototype.isReadOnly=function(){var t=this.getSharedGroup();return!!t&&t.isReadOnly()},VaultItemBase.prototype.getShareInfo=function(){var t=this.getSharedGroup();return t?t._shareInfo:null},VaultItemBase.prototype.getSharedGroup=function(){return this._sharedGroup||null},VaultItemBase.prototype.getURLArguments=function(t,e,a){return n.param(this.getPostData(t,e,a))},VaultItemBase.prototype.getGroupName=function(){return this._data.group},VaultItemBase.prototype.getGroupParentName=function(){var t=this._data.group,e=t.lastIndexOf("\\");return 0<e?t.substring(0,e):""},VaultItemBase.prototype.getSearchTokens=function(t){return[this.getName()]},VaultItemBase.prototype.getPostData=function(t,e,a){var o={extjs:1,localupdate:1,ajax:1};return a&&(a.source&&(o.source=a.source),a.folder)&&(o.folder=a.folder),bg.Policies.logNameEnabled()&&(o.n=bg.AES.url2hex(t.name)),bg.Policies.logUserNameEnabled()&&(o.un=bg.AES.url2hex(t.unencryptedUsername)),""===t.totp&&(o.totp=""),o},VaultItemBase.prototype.passwordProtected=function(){return this.getRepromptType()&&bg.get("g_prompts")[this.getRepromptType()]},VaultItemBase.prototype.getLastTouch=function(){return 0},VaultItemBase.prototype.edit=function(t){Topics.get(this.getEditTopicID()).publish({vaultItem:this,dialogActions:t.dialogActions,isPasskeyEditDialog:void 0!==t.itemsForAction.find(function(t){return"Passkey"===t._data.recordType})})},VaultItemBase.prototype.encryptIfNecessary=function(t,e,a){var o=this.getKey();return g.decryptMobile(this._data[t],!0,o)!==e||a!==o?g.encryptMobile(e,!0,a):this._data[t]},VaultItemBase.prototype.noFolderTrackingEvent=function(t){var e=t.group;if(e&&e!==Strings.Consts.NONE_GROUP){for(var a=g.getGroups(),o=!1,r=!1,s=0,n=a.length,i;s<n;++s){switch(a[s].getName()){case e:o=!0;break;case Strings.Consts.NONE_GROUP:r=!0}}var p={folder:e,foldercount:r?a.length:a.length+1,nofolderfeatureenabled:!!bg.get("g_nofolder_feature_enabled")};t.hasOwnProperty("groupParent")&&(p.source="manual"),o||bg.sendLpImprove("no_folder::user_folder_created",p)}},VaultItem.prototype.handleClickEvent=function(t,e){t===Constants.ACTION_SHARE?this.share(e):VaultItemBase.prototype.handleClickEvent.apply(this,arguments)},VaultItem.prototype.share=function(t){this.passwordProtect(function(){Topics.get(Topics.ITEM_SHARE).publish(t.itemsForAction)},t)},VaultItem.prototype.revertPasswordChange=function(t){LPRequest.makeUpdateRequest(g.revertPasswordChange,{params:{key:this.getKey(),aid:this.getID(),shareId:this.getShareID()},success:function(){t&&"function"==typeof t.success&&t.success()},error:function(){t&&"function"==typeof t.error&&t.error()}})},VaultItem.prototype.getPasskeyItems=function(t){return t.filter(function(t){return t._data.record&&"Passkey"===t._data.record.recordType})||[]},VaultItem.prototype.getNonPasskeyItems=function(t){return t.filter(function(t){return!t._data.record})||[]},VaultItem.prototype.getItemsIdList=function(t){return t.map(function(t){return t._data.id})||[]},VaultItem.prototype.deleteItem=function(a){for(var n=a&&a.itemsForAction||[this],t,e=0,o=n.length;e<o;++e){var r=n[e];if(r.isReadOnly())return void Topics.get(Topics.ERROR).publish(Strings.translateString(Strings.VaultDynamic.PERMISSION_ERROR_DELETE,r.getSharedGroup().toString()));if(void 0===t)t=r.getSharedGroup();else if(t!==r.getSharedGroup())return void Topics.get(Topics.ERROR).publish(Strings.translateString("Sorry, you cannot perform this operation on a mix of shared and non-shared folders, or multiple shared folders at once."))}var s=!(!n[0]._data.individualshare&&!n[0]._data.sharedfromaid);bg.sendLpImprove("Delete Item Button Clicked",{type:n[0]._noteType||"password",shared:s.toString()}),this.passwordProtect(function(){var o=VaultItem.prototype.getPasskeyItems.call(this,n),r=VaultItem.prototype.getItemsIdList.call(this,o),s=VaultItem.prototype.getNonPasskeyItems.call(this,n);LPRequest.makeLockItemUpdateRequest(function(t,e,a){s.length&&g.deleteItem(s,e,a),o.length&&reduxApp.permanentlyDeletePasskeyFromLegacyVault(r).then(function(){e()}).catch(function(){a()})},{parameters:[n],items:n,success:function(t){bg.sendLpImprove("Delete Item",{type:n[0]._noteType||"password"}),n[0].publishDeleteSuccess(n.length);for(var e=0;e<n.length;++e)n[e].deleteUpdates(!1);a.success&&a.success()},error:function(){a.error&&"function"==typeof a.error&&a.error()},confirm:h.getOption(a,"confirm",!0)?n[0].confirmDelete(n):null})},a)},VaultItem.prototype.moveToFolderPostCheck=function(a,t,o,r){var s,e;(0<a.length||0<t.length)&&((s=h.getOption(r,"saveFromDialog",!(e=function(){var e=a.concat(t);LPRequest.makeLockItemUpdateRequest(g.moveToFolder,{parameters:[e,o],items:e,success:function(t){var t;c(a,t,o,r),u(t,o,r),s||(t=o.toString(),bg.get("g_nofolder_feature_enabled")?(t===Strings.Vault.GROUP+" "+Strings.Consts.NONE_GROUP&&(t=Strings.Vault.NO_FOLDER),e[0].publishOrganizeSuccess(e.length,t)):(e[0].publishMoveSuccess(e.length,t),e.forEach(function(t){var e;t instanceof Passkey&&(e={id:t._data.id,folder:o._data.group,loginUrl:t._data.url,username:t._data.username,notes:t._data.notes,encname:t._data.encname,name:t._data.name,fav:t._data.fav,pwprotect:t._data.pwprotect},t.update(e,o))}))),r&&r.success&&r.success()},confirm:l(a,o)})})))?e():VaultItemBase.prototype.passwordProtect.call(VaultItem.prototype,e,{itemsForAction:a.concat(t)}))},Group.prototype.moveToFolderPostCheck=function(e,t,a,o){var r=n.extend(!0,{},this._data),s;r.group=a.getName()+"\\"+this.getGroupName(),s=this,LPRequest.makeUpdateRequest(g.renameGroup,{parameters:[s,r],success:function(t){c([s],t,a,o),c(e,t,a,n.extend(o,{updateViews:!1})),u(t,a,o),s.publishMoveSuccess(1,a.toString())},confirm:l(e,a)})},c=function(t,e,a,o){for(var r=0,s=t.length;r<s;++r){var n=t[r],i=n.getID();e&&e[i]?(n.update(e[i],a,o),delete e[i]):n.update(n._data,a,o)}},u=function(t,e,a){for(var o in t){var o=t[o];o.sn?new Note(o,e.getSharedGroup()).publishAdd(Topics.NOTE_ADDED,e,a):new(o.appaid?Application:Account)(o,e.getSharedGroup()).publishAdd(Topics.SITE_ADDED,e,a)}},l=function(t,e){for(var a=null,o=!1,r=!1,s=!1,n=!1,i=e?e.getSharedGroup():null,p=0,c=t.length,e;p<c;++p){var u=t[p],l=u.getSharedGroup();l?i?l!==i&&(o=!0):l instanceof LinkedGroup||(n=!0):!i||i instanceof LinkedGroup||(u._data.individualshare?s=!0:r=!0)}return(o||r||n||s)&&(e=[],o&&e.push(Strings.translateString("You are moving items to a different shared folder. This may change who has access to them.")),r&&u._data&&"Passkey"===u._data.recordType?e.push("Passkey"):r&&e.push(Strings.translateString("You are moving sites to a shared folder. Others may now have access to them.")),n&&e.push(Strings.translateString("You are moving items from a shared folder into your vault. Others may lose access to them.")),s?(e.push(Strings.translateString("Any item that is currently shared with another user cannot be moved into a shared folder.")),e.push(Strings.translateString("Would you like to make a copy?"))):e.push(Strings.translateString("Do you want to continue?")),a={title:Strings.translateString("Shared Folders"),text:e}),a},AccountBase.prototype.saveFromDialog=function(t,e){var a=l([this],e);if(a)if(-1<a.text.indexOf("Passkey"))Topics.get(Topics.ERROR).publish(Strings.translateString(Strings.VaultDynamic.PASSKEY_SHARED_FOLDER_ERROR_MOVE,e.toString()));else{for(var o=[VaultItem.prototype.saveFromDialog],r=0,s=arguments.length;r<s;++r)o.push(arguments[r]);a.handler=this.createHandler.apply(this,o),Topics.get(Topics.CONFIRM).publish(a)}else VaultItem.prototype.saveFromDialog.apply(this,arguments)},VaultItem.prototype.moveToFolder=function(t,e,a){if(0<this.getPasskeyItems(e).length&&t._data.group.startsWith("Shared"))Topics.get(Topics.ERROR).publish(Strings.translateString(Strings.VaultDynamic.PASSKEY_SHARED_FOLDER_ERROR_MOVE));else if(t.isReadOnly())Topics.get(Topics.ERROR).publish(Strings.translateString(Strings.VaultDynamic.PERMISSION_ERROR_MOVE,t.toString()));else{for(var o=[],r=[],s=[],n=[],i=t.getSharedGroup(),p=0,c=e.length;p<c;++p){var u=e[p];(u.isReadOnly()?s:i&&u._data.individualshare?0<parseInt(u._data.sharedfromaid)?r:o:n).push(u)}var l=[];0<r.length&&l.push({type:"alert",title:Strings.translateString("An error occurred. Please try again later."),text:[Strings.translateString("The following items have been individually shared with you and cannot be moved into a shared folder:"),h.buildDialogItemContainer(r)]}),0<s.length&&l.push({type:"alert",title:Strings.translateString("An error occurred. Please try again later."),text:[Strings.translateString("You do not have permission to move the following items from their respective shared folders:"),h.buildDialogItemContainer(s)]}),0<o.length&&l.push({type:"confirmation",title:Strings.translateString("An error occurred. Please try again later."),text:[Strings.translateString("The following items have already been shared individually and cannot be moved to a shared folder:"),Strings.translateString("Would you like to make a copy?"),h.buildDialogItemContainer(o)],closeHandler:function(){o.splice(0,o.length)}}),0<l.length?h.openAlerts(l,(d=this,function(){d.moveToFolderPostCheck.call(d,n,o,t,a)})):this.moveToFolderPostCheck.call(this,n,o,t,a)}var d},VaultItem.prototype.passwordProtected=function(){return this._data.pwprotect||VaultItemBase.prototype.passwordProtected.apply(this,arguments)},VaultItem.prototype.getPostData=function(t,e){var a=VaultItemBase.prototype.getPostData.apply(this,arguments);return t.pwprotect&&(a.pwprotect="on"),a},AccountBase.prototype.getLastTouch=function(){return parseInt(this._data.last_touch)},AccountBase.prototype.getID=function(){return this._data.aid},AccountBase.prototype.setID=function(t){this._data.aid=t},AccountBase.prototype.getFormData=function(t){var e=VaultItem.prototype.getFormData.apply(this,arguments);return e.extra=g.decryptMobile(this._data.extra,!0,this.getKey()),e},AccountBase.prototype.getPostData=function(t,e){var a=VaultItem.prototype.getPostData.apply(this,arguments),o=e?e.getKey():g.getLocalKey(),r=(a.aid=this.getID(),a.name=g.encryptWithKey(t.name,o),a.extra=g.encryptWithBTOA(t.extra),e?e.getSharedGroup():null);r?(a.sharedfolderid=r.getID(),a.grouping=g.encryptWithKey(t.group.substring(r.getName().length+1),o)):a.grouping=g.encryptWithKey(t.group,o);try{var s=bg.get("LPContentScriptFeatures").url_encryption,n="http://sn"!==t.url&&"http://group"!==t.url;s&&n&&(t.url.match(/^[a-z\-]+?[0-9]*\:\/\//i)||(t.url="http://"+t.url),a.url=g.encryptWithKey(t.url,o))}catch(t){console.warn("Cannot encrypt url!")}return t.pwprotect&&(a.pwprotect="on"),"1"===t.fav&&(a.fav="on"),t.totp&&(a.totp=g.encryptWithBTOA(t.totp)),a},AccountBase.prototype.checkForSharedGroupChange=function(t){var e=this.getSharedGroup(),t=t.getSharedGroup();return(null!==e||null!==t)&&e!==t},AccountBase.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_COPY_TOTP:this.copyTotp();break;case Constants.ACTION_COPY_USERNAME:this.copyUsername();break;case Constants.ACTION_COPY_PASSWORD:this.copyPassword(e);break;case Constants.ACTION_CLONE:this.cloneItem();break;default:VaultItem.prototype.handleClickEvent.apply(this,arguments)}},AccountBase.prototype.getSearchTokens=function(t){var e=VaultItem.prototype.getSearchTokens.apply(this,arguments);return t.searchNotes&&this._data.extra&&!this.passwordProtected()&&e.push(g.decryptMobile(this._data.extra,!0,this.getKey())),e},AccountBase.prototype.getCloneData=function(){var t=this.getFormData(DialogInput.getProperties(this._data));return t.name=t.name+" - "+Strings.translateString("Copy"),delete t.aid,t},AccountBase.prototype.processEnteredData=function(t,e,a){VaultItem.prototype.processEnteredData.apply(this,arguments),t.encgroup=this.encryptIfNecessary("encgroup",t.group,a)||"",t.encname=this.encryptIfNecessary("encname",t.name,a),t.action&&(t.action=bg.AES.bin2hex(t.action))},AccountBase.prototype.isShared=function(){return VaultItem.prototype.isShared.apply(this,arguments)||this._data.individualshare||this._data.sharedfromaid},AccountBase.prototype.isSharingEnabled=function(){return!(null!==this.getSharedGroup()||this._data.passkey||this._data.individualshare&&this._data.sharedfromaid&&""!==this._data.sharedfromaid)},AccountBase.prototype.copyTotp=function(){g.copyTotp(this)},AccountBase.prototype.copyUsername=function(){g.copyUsername(this)},AccountBase.prototype.copyPassword=function(){this.canViewPassword()?this.passwordProtect(function(){g.copyPassword(this)}):Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to copy the password."))},AccountBase.prototype.isReceivedShare=function(){return this._data.individualshare&&this._data.sharedfromaid},AccountBaseWithFields.prototype.REPROMPT_TYPE_VIEW_PW="view_pw_prompt",AccountBaseWithFields.prototype.getFormData=function(t){var e=AccountBase.prototype.getFormData.apply(this,arguments);e.fields=[];for(var a=0,o=this._data.fields.length;a<o;++a){var r=this._data.fields[a],s={name:r.name||r.id,type:r.type,value:this.getFieldValue(r,!0),formname:r.formname};"checkbox"===s.type&&(s.valueAttribute=r.value),e.fields.push(s)}return e.save_all=this._data.save_all,e},AccountBaseWithFields.prototype.processEnteredData=function(t,e,a,o){AccountBase.prototype.processEnteredData.apply(this,arguments);var r=this.getKey(),s=t.unencryptedUsername,n=t.password;if(t.username=this.encryptIfNecessary("username",t.unencryptedUsername,a),t.password=this.encryptIfNecessary("password",t.password,a),t.extra=this.encryptIfNecessary("extra",t.extra,a),t.totp=this.encryptIfNecessary("totp",t.totp,a),t.fields)for(var i=0;i<t.fields.length;++i){var p=t.fields[i],c=this.getFieldValue(p),u=this._data.fields[i],l;c!==this.getFieldValue(u,!0)||r!==a||p.formname!==u.formname||p.name!==u.name?(this.processEnteredFieldData(p,e,a),c===s&&"password"!==p.type?p.value=t.username:n===c&&"password"===p.type?p.value=t.password:o.saveFields=!0):t.fields[i]=u}},AccountBaseWithFields.prototype.getFieldValue=function(t,e){var a=null;if(t)switch(a=t.value,t.type){case"checkbox":void 0!==t.checked&&(a=t.checked);break;case"radio":case"select":case"select-one":break;default:e&&(a=g.decryptMobile(t.value,!0,this.getKey()))}return a},AccountBaseWithFields.prototype.processEnteredFieldData=function(t,e,a){switch(this.defaultFieldValues(t),t.type){case"checkbox":t.checked=t.value,t.value=t.valueAttribute||"";break;case"radio":case"select":case"select-one":break;default:void 0===a&&(a=(e||this).getKey()),t.value=g.encryptMobile(t.value,!0,a)}},AccountBaseWithFields.prototype.getFieldPostData=function(t,e){var a=t.value;switch(t.type){case"checkbox":e&&(a+=t.checked?"-1":"-0");break;case"radio":a+="-1";break;case"select":case"select-one":break;default:a=g.encryptWithBTOA(t.value)}var o={name:t.name,type:t.type,value:a,urid:t.urid};return t.formname&&(o.formname=t.formname),o},AccountBaseWithFields.prototype.defaultFieldValues=(d={checked:!1,formname:"",name:"",otherfield:!1,otherlogin:"0",type:"",urid:"0",url:"",value:""},function(t){this.defaultFields(d,t)}),AccountBaseWithFields.prototype.removeField=function(t){this._data.fields.splice(t,1)},AccountBaseWithFields.prototype.addField=function(t,e){return void 0===e&&(e=this._data.fields),t=n.extend({},t),this.defaultFieldValues(t),e.push(t),e.length-1},AccountBaseWithFields.prototype.canViewPassword=function(){var t=this.getSharedGroup();return!t||t.hasPasswordAccess()},AccountBaseWithFields.prototype.cloneItem=function(){this.canViewPassword()?this.passwordProtect(function(){Topics.get(this.getEditTopicID()).publish({defaultData:this.getCloneData()})},{types:this.REPROMPT_TYPE_VIEW_PW}):Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to copy the password."))},Account.prototype.REPROMPT_TYPE="edit_site_prompt",Account.prototype.isURLLaunchable=function(){return void 0!==this._data.url&&(0===this._data.url.indexOf("http://")||0===this._data.url.indexOf("https://")||0===this._data.url.indexOf("ssh://"))},Account.prototype.isSharingEnabled=function(){return this._data.url&&AccountBase.prototype.isSharingEnabled.apply(this,arguments)},Account.prototype.isLaunchEnabled=function(){return this.isURLLaunchable()},Account.prototype.canViewPassword=function(){return AccountBaseWithFields.prototype.canViewPassword.apply(this,arguments)&&!this.isReceivedShare()},Account.prototype.getEditTopicID=function(){return Topics.EDIT_SITE},Account.prototype.getTotp=function(){var t,e;return this._data.totp?(t=g.decryptMobile(this._data.totp,!0,this.getKey()),(new jsOTP.totp).getOtp(t)):""},Account.prototype.getPassword=function(){if(this._data.save_all){for(var t=0,e=this._data.fields.length;t<e;++t){var a=this._data.fields[t];if("password"===a.type&&a.value)return g.decryptMobile(a.value,!0,this.getKey())}return""}return g.decryptMobile(this._data.password,!0,this.getKey())},Account.prototype.getSearchTokens=function(t){var e=AccountBaseWithFields.prototype.getSearchTokens.apply(this,arguments),a=this.getUsername();return a&&e.push(a),this._data.url&&e.push(bg.hostof(this._data.url)),this._data.aid&&e.push(this._data.aid),e},Account.prototype.getRepromptType=function(){return this.REPROMPT_TYPE},Account.prototype.getUsername=function(){if(this._data.save_all)for(var t=0,e=this._data.fields.length;t<e;++t){var a=this._data.fields[t];switch(a.type){case"text":case"email":case"tel":if(a.value)return g.decryptMobile(a.value,!0,this.getKey())}}return void 0===this._data.unencryptedUsername&&(this._data.unencryptedUsername=g.decryptMobile(this._data.username,!0,this.getKey())),this._data.unencryptedUsername},Account.prototype.hasGeneratedPassword=function(){return this._data.genpw||0===this.getName().indexOf(Strings.Vault.GENERATED_PREFIX)},Account.prototype.toString=function(){return Strings.Vault.SITE+": "+this._data.name},Account.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_COPY_URL:this.copyURL();break;case Constants.ACTION_LAUNCH:this.launch(e);break;case Constants.ACTION_GO_TO_URL:this.goToURL();break;case Constants.ACTION_FILL:case Constants.ACTION_FILL_SITE:this.fill(e);break;default:AccountBase.prototype.handleClickEvent.apply(this,arguments)}},Account.prototype.launch=function(t){this.passwordProtect(function(){g.launchSite(this,t)},{types:"login_site_prompt"})},Account.prototype.fill=function(t){parent.reduxApp&&parent.reduxApp.dropdownFill&&bg.get("LPContentScriptFeatures").web_client_fill?parent.reduxApp.dropdownFill(this.getID()):this.passwordProtect(function(){bg.sendLpImprove("sitelogin",{copy:0,shareType:this.getShareType(),autologin:this._data&&this._data.autologin?1:0,source:t&&t.source?t.source:null,approach:t&&t.approach?t.approach:null},!0),g.fillSite(this)},{types:"login_site_prompt"})},Account.prototype.copyPassword=function(t){this.canViewPassword()?this.passwordProtect(function(){bg.sendLpImprove("sitelogin",{copy:1,shareType:this.getShareType(),autologin:this._data&&this._data.autologin?1:0,source:t&&t.source?t.source:null,approach:t&&t.approach?t.approach:null},!0),g.copyPassword(this,t)},{types:this.REPROMPT_TYPE_VIEW_PW}):Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to copy the password."))},Account.prototype.copyURL=function(){g.copyURL(this)},Account.prototype.goToURL=function(){g.goToURL(this)},Account.prototype.getShareType=function(){var t=this._data;return t&&!0===t.individualshare?"individual":t&&t.sharefolderid?"folder":"none"},Account.prototype.processEnteredData=function(t,e,a){t.save_all&&(delete t.unencryptedUsername,delete t.password),AccountBaseWithFields.prototype.processEnteredData.apply(this,arguments),t.url&&(t.url=bg.punycode.URLToUnicode(t.url.trim())),t.realm_data&&(t.realm_data=g.encryptMobile(t.realm_data,!0,a))},Account.prototype.getFormData=function(t){var e=AccountBaseWithFields.prototype.getFormData.apply(this,arguments);if(e.url)try{e.url=bg.punycode.URLToUnicode(e.url)}catch(t){e.url="",console.error("Encountered an error while decoding the URL of the account",t)}return t.password&&(e.password=this.getPassword()),t.unencryptedUsername&&(e.unencryptedUsername=this.getUsername()),t.totp&&(e.totp=g.decryptMobile(this._data.totp,!0,this.getKey()),""!=e.totp)&&(e.totpCode="******"),e},y=function(t,e){for(var a=g.getDomain(t.getURL()),o=[],r=g.getSiteModels(),s=0,n=r.length;s<n;++s){var i=r[s];i!==t&&g.getDomain(i.getURL())===a&&i.getPassword()===e&&o.push(i)}0<o.length&&dialogs.changePassword.open({domain:a,items:o,newPassword:t.getPassword()})},Account.prototype.save=function(t,o,r){var s;s=this,LPRequest.makeUpdateRequest(g.saveSite,{parameters:[s,t,o,r],success:function(t){var e=s.getPassword(),a;s.update(t,o),s.publishSaveSuccess(1),e!==s.getPassword()&&y(s,e),r.success&&r.success(s)},requestSuccessOptions:{closeDialog:!0}})},Account.prototype.add=function(e,a){var o;o=this,LPRequest.makeUpdateRequest(g.addSite,{parameters:[o,e,a],success:function(t){o.update(t,e),o.publishAdd(Topics.SITE_ADDED,e),a.success&&a.success(o)}})},Account.prototype.getPostData=function(t,e,a){var o=AccountBaseWithFields.prototype.getPostData.apply(this,arguments),r=(o.username=t.username?g.encryptWithBTOA(t.username):"",o.password=t.password?g.encryptWithBTOA(t.password):"",o.domain=bg.AES.url2hex(bg.lp_gettld_url(t.url)),bg.AES.url2hex(t.url));try{var s=bg.get("LPContentScriptFeatures").url_encryption,n="http://sn"!==t.url&&"http://group"!==t.url;s&&n&&(r=o.url)}catch(t){console.warn("Cannot use encrypt url!")}return h.getOption(a,"saveFromSubmit",!1)?(o.ref=r,this.isNew()||(o.replacing=1)):o.url=r,t.never_autofill&&(o.never_autofill="on"),t.autologin&&(o.autologin="on"),(t.save_all||h.getOption(a,"saveFromSubmit",!1))&&(o.data=this.getFieldFormData(t.fields)),t.save_all&&(o.save_all=1),o.urid=t.urid,"1"===t.basic_auth&&(o.basic_auth="1"),t.realm_data&&(o.realm=g.encryptWithBTOA(t.realm_data)),o},Account.prototype.getFieldFormData=function(t){for(var e="",a=0,o=t.length;a<o;++a){var r=t[a],s=this.getFieldPostData(r,!0).value;e+=r.formname+"\t"+encodeURIComponent(r.name)+"\t"+encodeURIComponent(s)+"\t"+encodeURIComponent(r.type)+"\n"}return bg.AES.bin2hex(e)},AuroraAccount.products={g2a:{name:"GoToAssist",promotionText:"GoToAssist",freeTrialTagDisplay:"block",icon:"logMeInIcon",tooltip:"Radically refreshing remote support",productId:"g2a"},g2w:{id:"g2w",name:"GoToWebinar",promotionText:"GoToWebinar",freeTrialTagDisplay:"block",icon:"logMeInIcon",tooltip:"Everything you need for great webinars",productId:"g2w"},g2ma:{name:"GoToMeeting",promotionText:"Try GoToMeeting Free",freeTrialTagDisplay:"none",icon:"goToMeetingIcon",tooltip:"As a customer, you're eligible for a free 30-day trial of GoToMeeting with unlimited time limits.",productId:"g2m"},g2mb:{name:"GoToMeeting",promotionText:"Free Meetings, On Us",freeTrialTagDisplay:"none",icon:"goToMeetingIcon",tooltip:"As a customer, you're eligible for a free 30-day trial of GoToMeeting with unlimited time limits.",productId:"g2m"}},AuroraAccount.prototype.createGoToAssistData=function(){return{auroraId:"g2a",name:AuroraAccount.products.g2a.name,storageKey:"promotion_g2a_clicked_"+bg.get("g_username_hash"),description:"GoToAssist helps service and support professionals resolve technical issues by delivering instant web-based support to customer, end users, unattended computers and servers.",imageUrl:"./images/vault_4.0/promotion/gotoassist.png",searchResultKeywords:["teamviewer","webex","beyondtrust"],competitorProductNames:["TeamViewer","Cisco Webex","Bomgar"],login:1===bg.localStorage_getItem("promotion_g2a_clicked_"+bg.get("g_username_hash"))}},AuroraAccount.prototype.createGoToWebinarData=function(){return{auroraId:"g2w",name:AuroraAccount.products.g2w.name,storageKey:"promotion_g2w_clicked_"+bg.get("g_username_hash"),description:"Create captivating online events that build brand awareness and help organizations spread their message.",imageUrl:"./images/vault_4.0/promotion/gotowebinar.png",searchResultKeywords:["zoom","webex","microsoft-teams","on24","adobeconnect"],competitorProductNames:["Zoom","Cisco Webex","MS Teams Live Events","On24","Adobe Connect"],login:1===bg.localStorage_getItem("promotion_g2w_clicked_"+bg.get("g_username_hash"))}},AuroraAccount.prototype.toString=function(){return this._data.name},AuroraAccount.prototype.handleClickEvent=function(t,e){var o=this,r=arguments,s=this._data.auroraId,n=this._data.name;t===Constants.ACTION_GO_TO_URL?(bg.sendLpImprove("promotion_vault_product_clicked",{product:this._data.auroraId,searchToken:this.currentSearch.searchToken,matchSource:this.currentSearch.matchSource,searchTextLength:this.currentSearch.searchTextLength}),bg.BackgroundServer.aurora.getOneClickSignupUrls({success:function(t){var e="promotion_"+s+"_clicked_"+bg.get("g_username_hash"),a;t&&t[s]&&((a=o._data.login||!!bg.localStorage_getItem(e))||(bg.localStorage_setItem(e,1),o._data.login=!0,(new Account).addFromDialog({name:n,url:t[s].login},null,{success:function(){return null}})),o._data.url=a?t[s].login:t[s].signup),Account.prototype.handleClickEvent.apply(o,r)}})):Account.prototype.handleClickEvent.apply(this,arguments)},AuroraAccount.prototype.isURLLaunchable=function(){return!0},AuroraAccount.prototype.getSearchTokens=function(t){var e=VaultItem.prototype.getSearchTokens.call(this,t);this._data.url&&e.push(bg.hostof(this._data.url));for(var a=0,o=this._data.competitorProductNames.length;a<o;a++)e.push(this._data.competitorProductNames[a]);return e},AuroraAccount.prototype.deleteItem=function(t){var e=this,a=[e];LPRequest.makeLockItemUpdateRequest(f,{parameters:[a],items:a,success:function(){e.deleteUpdates(),bg.sendLpImprove("promotion_vault_do_not_show_again",{product:e._data.auroraId}),t.success&&t.success()},confirm:h.getOption(t,"confirm",!0)?e.confirmDelete():null})},AuroraAccount.prototype.confirmDelete=function(){return{title:"Remove this suggestion?",text:"Don't show this suggested product again: "+this.toString()}},AuroraAccount.prototype.deleteUpdates=function(){this.destroyViews(),Topics.get(Topics.ITEM_REMOVED).publish()},f=function(t,e,a){try{bg.Preferences.set("hide_aurora_"+t[0]._data.auroraId,!0),e()}catch(t){a()}},Application.prototype.REPROMPT_TYPE="edit_site_prompt",Application.prototype.toString=function(){return Strings.Vault.APPLICATION+" "+this.getName()},Application.prototype.getEditTopicID=function(){return Topics.EDIT_APPLICATION},Application.prototype.shouldPasswordProtectShare=function(){return!1},Application.prototype.getCloneData=function(){var t=AccountBaseWithFields.prototype.getCloneData.apply(this,arguments);return delete t.appaid,t},Application.prototype.getID=function(t){var e=this._data.appaid;return e=t?"app"+e:e},Application.prototype.setID=function(t){this._data.appaid=t},Application.prototype.isSharingEnabled=function(){return!1},Application.prototype.getLastTouch=AccountBase.prototype.getLastTouch,Application.prototype.handleClickEvent=function(t,e){t===Constants.ACTION_LAUNCH?g.launchApplication(this):AccountBaseWithFields.prototype.handleClickEvent.apply(this,arguments)},Application.prototype.update=function(){AccountBaseWithFields.prototype.update.apply(this,arguments),this.setSaveAll()},Application.prototype.addField=function(){AccountBaseWithFields.prototype.addField.apply(this,arguments),this.setSaveAll()},Application.prototype.removeField=function(){AccountBaseWithFields.prototype.removeField.apply(this,arguments),this.setSaveAll()},Application.prototype.setSaveAll=function(){for(var t,e,a=0;a<this._data.fields.length;++a){var o=this._data.fields[a];switch(o.type){case"password":t=void 0===t?o:null;break;case"":e=void 0===e?o:null}}this._data.save_all=!0,delete this._data.unencryptedUsername,delete this._data.username,delete this._data.password,e&&(this._data.save_all=!1,this._data.unencryptedUsername=g.decryptMobile(e.value,!0,this.getKey()),this._data.username=e.value),t&&(this._data.save_all=!1,this._data.password=t.value)},Application.prototype.getUsername=function(){for(var t=0;t<this._data.fields.length;++t){var e=this._data.fields[t];if("password"!==e.type&&e.value)return g.decryptMobile(e.value,!0,this.getKey())}},Application.prototype.getPassword=function(){for(var t=0;t<this._data.fields.length;++t){var e=this._data.fields[t];if("password"===e.type&&e.value)return g.decryptMobile(e.value,!0,this.getKey())}},Application.prototype.processEnteredData=function(t,e,a,o){var r,s;AccountBaseWithFields.prototype.processEnteredData.apply(this,arguments);for(var n=0;n<t.fields.length;++n){var i=t.fields[n];switch(i.type){case"password":r=i;break;case"":s=i}}s?s.value=t.username:t.fields.push({id:"0",type:"",value:t.username}),r?r.value=t.password:t.fields.push({id:"1",type:"password",value:t.password})},Application.prototype.getFormData=function(t){var e=AccountBaseWithFields.prototype.getFormData.apply(this,arguments);return this._data.save_all||(e.password=g.decryptMobile(this._data.password,!0,this.getKey())),e},Application.prototype.getSearchTokens=function(){var t=VaultItem.prototype.getSearchTokens.apply(this,arguments);return t.push(this._data.appname),t},Application.prototype.add=function(e,t){var a;a=this,LPRequest.makeUpdateRequest(g.addApplication,{parameters:[a,e,t],success:function(t){a.update(t,e),a.publishAdd(Topics.APPLICATION_ADDED,e)}})},Application.prototype.save=function(t,e,a){var o;o=this,LPRequest.makeUpdateRequest(g.saveApplication,{parameters:[o,t,e,a],success:function(){o.update(t,e),o.publishSaveSuccess(1)}})},Application.prototype.getPostData=function(t,e){var a=AccountBase.prototype.getPostData.apply(this,arguments);if(a.appname=t.appname,t.fields)for(var o=0;o<t.fields.length;++o){var r=t.fields[o];a["fieldid"+o]=r.name||r.id,a["fieldtype"+o]=r.type,a["fieldvalue"+o]=this.getFieldPostData(r).value}return a.appaid=a.aid,delete a.aid,this.isNew()||(a.cmd="updatelpaa"),a},Application.prototype.getRepromptType=function(){return this.REPROMPT_TYPE},Group.prototype.getDisplayClass=function(){return GroupDisplay},Group.prototype.toString=function(){return Strings.Vault.GROUP+" "+this._data.group},Group.prototype.getName=function(){return this._data.group},Group.prototype.getGroupName=function(){return this._data.group.substring(this._data.group.lastIndexOf("\\")+1)},Group.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_RENAME:Topics.get(Topics.RENAME_FOLDER).publish(this);break;case Constants.ACTION_CREATE_SUB_FOLDER:Topics.get(Topics.CREATE_SUB_FOLDER).publish(this);break;case Constants.ACTION_SHARE:var a=this._views[0]._filteredItems;this.hasPasskeyInTheGroup(a)?Topics.get(Topics.ERROR).publish(Strings.translateString(Strings.VaultDynamic.FOLDER_CONTAINS_PASSKEY_ERROR_SHARE)):Topics.get(Topics.CREATE_SHARED_FOLDER).publish(this,e.itemsForAction);break;default:VaultItemBase.prototype.handleClickEvent.apply(this,arguments)}},Group.prototype.hasPasskeyInTheGroup=function(t){return t.find(function(t){return t instanceof PasskeyDisplay})},Group.prototype.confirmDelete=function(t){return 0<t?(e=this,{title:Strings.Vault.DELETE,text:Strings.translateString(Strings.VaultDynamic.DELETE_CONFIRM,Strings.translateString("%s containing %d item(s)",e.toString(),t))}):VaultItemBase.prototype.confirmDelete.apply(this);var e},Group.prototype.deleteItem=function(t){var e=t.itemsForAction.filter(function(t){return!(t instanceof Group)}),a;LPRequest.makeLockItemUpdateRequest(g.deleteFolder,{parameters:[t.itemsForAction],items:t.itemsForAction,success:function(){a.deleteUpdates()},confirm:(a=this).confirmDelete(e.length)})},Group.prototype.add=function(e){var a;a=this,LPRequest.makeUpdateRequest(g.addGroup,{parameters:a,success:function(t){a.update(t,e),a.publishAdd(Topics.GROUP_ADDED,e)}})},Group.prototype.save=function(t,e){var a;a=this,LPRequest.makeUpdateRequest(g.renameGroup,{parameters:[a,t],success:function(){a.update(t,e),a.publishRenameSuccess(1)}})},Group.prototype.getFormData=function(t){var e=VaultItemBase.prototype.getFormData.apply(this,arguments);return e.groupName=this.getGroupName(),e.groupParent=this.getGroupParentName(),e},Group.prototype.processEnteredData=function(t){VaultItemBase.prototype.processEnteredData.apply(this,arguments),t.groupName&&(t.groupParent?(t.group=t.groupParent+"\\"+t.groupName,delete t.groupParent):t.group=t.groupName,delete t.groupName)},SharedGroup.prototype.setID=function(t){Group.prototype.setID.apply(this,arguments),this._data.sharefolderid=t,this._shareInfo.id=t,this._shareInfo.shareid=t},SharedGroup.prototype.useSharePrefix=function(){return!0},SharedGroup.prototype.update=function(t){t&&(this._shareInfo.decsharename=t.group),Group.prototype.update.apply(this,arguments)},SharedGroup.prototype.isReadOnly=function(){return"1"===this._shareInfo.readonly},SharedGroup.prototype.canAdminister=function(){return"1"===this._shareInfo.can_administer},SharedGroup.prototype.isPending=function(){return"0"===this._shareInfo.accepted},SharedGroup.prototype.canConvertToLegacy=function(){return g.isEligibleForLegacySharedFolders()&&this.canAdminister()&&"0"!==this._shareInfo.cid&&bg.get("LPContentScriptFeatures").family_legacy_shared_folders_enabled},SharedGroup.prototype.canConvertToEnterprise=function(){return g.isEnterpriseUser()&&this.canAdminister()&&"1"===this._shareInfo.outside_enterprise&&"0"===this._shareInfo.cid},SharedGroup.prototype.isDownloaded=function(){return"1"===this._shareInfo.download},SharedGroup.prototype.hasPasswordAccess=function(){return"1"===this._shareInfo.give},SharedGroup.prototype.isDeleted=function(){return"1"===this._shareInfo.deleted},SharedGroup.prototype.isSharingEnabled=function(){return!1},SharedGroup.prototype.getShareName=function(){return this._shareInfo.sharename},SharedGroup.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_START_DOWNLOADING:this.startDownloading();break;case Constants.ACTION_STOP_DOWNLOADING:this.stopDownloading();break;case Constants.ACTION_MANAGE:case Constants.ACTION_MANAGE_RECIPIENTS:this.manage();break;case Constants.ACTION_MANAGE_ITEMS:reduxApp.openSharingDrawer(this._data.sharefolderid),bg.sendLpImprove("Manage Items Clicked",{source:"Sharing Center Actions menu"});break;case Constants.ACTION_RESTORE_SHARED_FOLDER:this.restoreSharedFolder();break;case Constants.ACTION_PURGE_SHARED_FOLDER:this.purgeSharedFolder();break;case Constants.ACTION_ACCEPT:this.accept();break;case Constants.ACTION_REJECT:this.reject();break;case Constants.ACTION_CONVERT:this.convert();break;default:Group.prototype.handleClickEvent.apply(this,arguments)}},SharedGroup.prototype.convert=function(){dialogs.convertLegacySharedFolder.open({shareId:this._shareInfo.id,groupName:this.getGroupName()})},SharedGroup.prototype.manage=(t=function(){this.canConvertToEnterprise()?this.convertToEnterprise():Topics.get(Topics.EDIT_SHARED_FOLDER).publish(this)},function(){this.passwordProtect(t)}),SharedGroup.prototype.accept=(m=function(t){"bad"==t.result&&"verificationrequired"==t.status?dialogs.verifyEmail.open({email:bg.get("g_username")}):(Topics.get(Topics.UPDATE_NOTIFICATION_COUNT).publish(),this.refresh(t.sharedFolder,t.shareInfo),this.update())},function(){LPRequest.makeRequest(bg.BackgroundServer.sharing.folder.accept,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},lockItems:!0,items:this,success:this.createHandler(m)})}),SharedGroup.prototype.reject=(_=function(){Topics.get(Topics.UPDATE_NOTIFICATION_COUNT).publish(),this.deleteUpdates(!1)},function(){LPRequest.makeUpdateRequest(bg.BackgroundServer.sharing.folder.reject,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},lockItems:!0,items:this,success:this.createHandler(_),confirm:{title:Strings.Vault.REJECT,text:[Strings.translateString("Are you sure you want to reject %s?",this.toString())]}})}),SharedGroup.prototype.stopDownloading=(S=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()},function(){LPRequest.makeUpdateRequest(g.stopDownloadingFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},lockItems:!0,items:this,success:this.createHandler(S),successMessage:Strings.translateString("%s will no longer be downloaded.",this.toString()),confirm:{title:Strings.Vault.STOP_DOWNLOADING,text:[Strings.translateString("You are choosing to stop downloading the content of this Shared Folder to your vault. You may always begin downloading the folder content again in the Sharing Center."),Strings.translateString("Do you want to continue?")]}})}),SharedGroup.prototype.add=(v=function(t,e,a){var o=[],r={};if(t){var s=t.getName(),n=a.getName(),i=function(t){o.push(t.getID()),r[t.getID()]=t._data.group.replace(s,n)};if(e)for(var p=0,c=e.length;p<c;++p){var u=e[p];u instanceof DummyGroup||i(u)}t instanceof DummyGroup||i(t)}return{itemsToMove:o,parentMap:r}},function(e,a,o){var r=v(e,a,this);LPRequest.makeUpdateRequest(g.createSharedFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},successMessage:0<r.itemsToMove.length?"":void 0,success:this.createHandler(function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update(),0<r.itemsToMove.length?LPRequest.makeRequest(g.moveIntoSharedFolder,{params:n.extend(r,{toShareInfo:this._shareInfo}),success:this.createHandler(function(){this.publishAdd(Topics.GROUP_ADDED),a&&a.forEach(function(t){t.update(t._data,this)},this),e&&e.destruct()})}):(this.publishAdd(Topics.GROUP_ADDED),e&&e.destruct()),"function"==typeof o&&o(t)})})}),SharedGroup.prototype.deleteItem=(V=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()},function(){reduxApp.openDeleteSharedFolderModal(this._data.sharefolderid)}),SharedGroup.prototype.getFormData=function(t){var e=Group.prototype.getFormData.apply(this,arguments);return e.groupName=this.getShareGroupName(),e},SharedGroup.prototype.processEnteredData=function(t){t.group=this.SHARED_FOLDER_NAME_PREFIX+t.groupName,delete t.groupName},SharedGroup.prototype.getShareGroupName=function(t){return(t=void 0===t?this._data.group:t).substring(this.SHARED_FOLDER_NAME_PREFIX.length)},SharedGroup.prototype.saveFromDialog=function(t,e){VaultItem.prototype.saveFromDialog.apply(this,arguments)},SharedGroup.prototype.save=(I=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()},function(t){LPRequest.makeUpdateRequest(g.renameSharedGroup,{params:{sharedFolder:t,shareInfo:this._shareInfo},success:this.createHandler(I),successMessage:this.getSuccessfulRenameMessage()})}),SharedGroup.prototype.getKey=function(){return this._shareInfo.key},SharedGroup.prototype.getSharedGroup=function(){return this},SharedGroup.prototype.startDownloading=(A=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()},function(){LPRequest.makeRequest(g.startDownloadingFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},lockItems:!0,items:this,success:this.createHandler(A),successMessage:Strings.translateString("%s will now be downloaded.",this.toString())})}),SharedGroup.prototype.restoreSharedFolder=(T=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()},function(){LPRequest.makeRequest(g.restoreDeletedSharedFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},lockItems:!0,items:this,success:this.createHandler(T),successMessage:this.getSuccessfulRestoreMessage()})}),SharedGroup.prototype.purgeSharedFolder=(E=function(){this.publishPurgeSuccess(1),this.deleteUpdates(!1)},function(){LPRequest.makeLockItemUpdateRequest(g.purgeDeletedSharedFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},items:this,success:this.createHandler(E),confirm:{title:Strings.Vault.PURGE,text:Strings.translateString(Strings.VaultDynamic.CONFIRM_PURGE,this.toString())}})}),SharedGroup.prototype.convertToEnterprise=(b=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()},function(){LPRequest.makeLockItemUpdateRequest(bg.BackgroundServer.sharing.folder.convertToEnterprise,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},items:this,success:this.createHandler(b),confirm:{title:Strings.translateString("Convert to Enterprise"),text:[Strings.translateString("This was a shared family folder, but you are now a part of a LastPass Enterprise account.  In order to continue administering this shared folder, you must move it into the enterprise account.  This may mean certain other members of the enterprise account will have access to it."),Strings.translateString("Do you want to continue?")]}})}),SharedGroup.prototype.toString=function(){return Strings.Vault.SHARED_FOLDER+": "+this.getName()},LinkedGroup.prototype.useSharePrefix=function(){return!1},LinkedGroup.prototype.handleClickEvent=function(t,e){var a=this;t===Constants.ACTION_UNLINK?g.reprompt(function(){a.unlink()})(a):SharedGroup.prototype.handleClickEvent.apply(this,arguments)},LinkedGroup.prototype.unlink=(P=function(){g.removeLinkedAccountInIe(),"function"==typeof bg.removeaccountlinktoken&&bg.removeAccountLinkToken(),Topics.get(Topics.SUCCESS).publish(Strings.translateString("Account (%s) unlinked.",this.getName())),this.deleteUpdates(!1),g.refreshSites(),Topics.get(Topics.ACCOUNT_UNLINKED).publish();for(var t=g.getFormFillModels(),e=0,a=t.length;e<a;++e){var o=t[e];o.getSharedGroup()===this&&o.deleteUpdates(!1)}},function(){LPRequest.makeUpdateRequest(g.unlinkAccount,{params:{id:this.getID()},success:this.createHandler(P),confirm:{title:Strings.Vault.UNLINK,text:Strings.translateString("Are you sure you want to unlink your personal account (%s)",this.getName())}})}),EmergencyAccessGroup.prototype.unlink=(B=function(){Topics.get(Topics.SUCCESS).publish(Strings.translateString("Account (%s) unlinked.",this.getName())),this.deleteUpdates(!1)},function(){LPRequest.makeUpdateRequest(g.unlinkEmergencyAccessAccount,{params:{folderID:this.getID(),email:this.getName()},success:this.createHandler(B),confirm:{title:Strings.Vault.UNLINK,text:Strings.translateString("Are you sure you want to unlink your personal account (%s)",this.getName())}})}),AuroraGroup.prototype.deleteItem=function(t){var e;LPRequest.makeLockItemUpdateRequest(U,{parameters:[t.itemsForAction],items:t.itemsForAction,success:function(){e.deleteUpdates()},confirm:(e=this).confirmDelete()})},AuroraGroup.prototype.confirmDelete=function(){return{title:"Do not show again",text:"Are you sure you do not want to see "+this.toString()+" again?"}},AuroraGroup.prototype.deleteUpdates=function(){this.destroyViews(),Topics.get(Topics.ITEM_REMOVED).publish()},U=function(t,e,a){try{for(var o=0;o<t.length;o++)t[o]instanceof AuroraGroup?(bg.Preferences.set("hide_aurora_group",!0),bg.sendLpImprove("promotion_vault_do_not_show_again",{product:"all"})):t[o]instanceof AuroraAccount&&bg.Preferences.set("hide_aurora_"+t[o]._data.auroraId,!0);e()}catch(t){a()}},Note.prototype.NOTE_TYPES={ADDRESS:"Address",BANK:"Bank Account",CREDIT:"Credit Card",DATABASE:"Database",DRIVERS_LICENSE:"Driver's License",EMAIL:"Email Account",GENERIC:"Generic",HEALTH_INSURANCE:"Health Insurance",IM:"Instant Messenger",INSURANCE:"Insurance",MEMBERSHIP:"Membership",PASSPORT:"Passport",SERVER:"Server",SSN:"Social Security",SOFTWARE_LICENSE:"Software License",SSH_KEY:"SSH Key",WIFI:"Wi-Fi Password",CUSTOM:"Custom",PASSKEY:"Passkey"},M=function(){var t={},e;for(e in Note.prototype.NOTE_TYPES)t[Note.prototype.NOTE_TYPES[e]]=!0;return t}(),Note.prototype.REPROMPT_TYPE="edit_sn_prompt",N=function(t){var t;return!!t&&(t=t.match(/^Custom_(\d+)$/))&&2==t.length},R=function(t){return N(t)||M[t]},D=function(t){var e;return-1!==["zh-CN","zh-TW","da-DK","nl-NL","en-US","en-GB","fi-FI","fr-FR","fr-CA","de-DE","hu-HU","it-IT","ja-JP","ko-FR","nb-NO","pl-PL","pt-PT","pt-BR","ru-RU","sk-SK","es-ES","es-MX","sv-SE"].indexOf(t)},Note.prototype.isValidLanguage=D,Note.prototype.getNoteType=function(){var t;return void 0===this._noteType&&(t=this._data.notetype||this.getKeyValuePairs().NoteType,this._noteType=R(t)?t:this.NOTE_TYPES.GENERIC),this._noteType},Note.prototype.getLanguage=function(){var t;return void 0===this._language&&(t=this._data.language||this.getKeyValuePairs().Language,D(t)||(t=navigator.language),this._language=D(t)?t:"en-US"),this._language},Note.prototype.getRecordType=function(){var t=this.getNoteType();return N(t)?"Custom":t},Note.prototype.getTemplate=function(){return this._data.template},Note.prototype.isCustom=function(){return N(this.getNoteType())},Note.prototype.getAttachmentKey=function(){return this._data.attachkey?bg.AES.hex2bin(g.decrypt(this._data.attachkey,this.getKey())):null},Note.prototype.debugAttachmentKey=function(t,e,a){var o=null,a=(null!==a?o=a:this._data.attachkey&&(o=this._data.attachkey),"undefined"!=typeof reduxApp&&"function"==typeof reduxApp.getState?reduxApp.getState().user.uid:"undefined"!=typeof bg&&bg.get("g_uid")?bg.get("g_uid"):"undefined"!==g_uid?g_uid:0),t={attachment_action:!0,action_type:t,user_id:a,attachment_id:e,attachment_key_hash:null!==o?bg.SHA256(o.slice(0,50)+a):null};n.ajax({global:!1,type:"POST",cache:!1,dataType:"json",data:t,url:g.getBaseURL()+"debug.php"})},Note.prototype.cloneItem=function(){this.passwordProtect(function(){Topics.get(Topics.EDIT_NOTE).publish({defaultData:this.getCloneData()})})},Note.prototype.getRepromptType=function(){return this.REPROMPT_TYPE},Note.prototype.getEditTopicID=function(){return Topics.EDIT_NOTE},Note.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_COPY_NOTE:this.copyNote();break;case Constants.ACTION_COPY_KEY:this.copyPrivateKey();break;case Constants.ACTION_FILL:this.fill(e);break;case Constants.ACTION_COPY_ADDRESS_1:this.copyNoteField("Address 1");break;case Constants.ACTION_COPY_ADDRESS_2:this.copyNoteField("Address 2");break;case Constants.ACTION_COPY_CITY_SLASH_TOWN:this.copyNoteField("City / Town");break;case Constants.ACTION_COPY_ZIP_SLASH_POSTAL_CODE:this.copyNoteField("Zip / Postal Code");break;case Constants.ACTION_COPY_EMAIL_ADDRESS:this.copyNoteField("Email Address");break;case Constants.ACTION_COPY_PHONE_NUMBER:this.copyPhoneNumber();break;case Constants.ACTION_COPY_BANK_NAME:this.copyNoteField("Bank Name");break;case Constants.ACTION_COPY_ACCOUNT_NUMBER:this.copyNoteField("Account Number");break;case Constants.ACTION_COPY_ROUTING_NUMBER:this.copyNoteField("Routing Number");break;case Constants.ACTION_COPY_NAME_ON_CARD:this.copyNoteField("Name on Card");break;case Constants.ACTION_COPY_SECURITY_CODE:this.copyNoteField("Security Code");break;case Constants.ACTION_COPY_POLICY_NUMBER:case Constants.ACTION_COPY_HEATH_INS_POLICY_NUMBER:this.copyNoteField("Policy Number");break;case Constants.ACTION_COPY_GROUP_ID:this.copyNoteField("Group ID");break;case Constants.ACTION_COPY_MEMBER_ID:this.copyNoteField("Member ID");break;case Constants.ACTION_COPY_INS_POLICY_NUMBER:this.copyNoteField("Policy Number");break;case Constants.ACTION_COPY_MEMBERSHIP_NUMBER:this.copyNoteField("Membership Number");break;case Constants.ACTION_COPY_PASSPORT_NUMBER:case Constants.ACTION_COPY_NUMBER:this.copyNoteField("Number");break;case Constants.ACTION_COPY_LICENSE_KEY:this.copyNoteField("License Key");break;case Constants.ACTION_COPY_ORDER_NUMBER:this.copyNoteField("Number");break;case Constants.ACTION_COPY_SSH_PASSPHRASE:this.copyNoteField("Passphrase");break;case Constants.ACTION_COPY_SSH_PUBLIC_KEY:this.copyNoteField("Public Key");break;case Constants.ACTION_COPY_HOSTNAME:this.copyNoteField("Hostname");break;case Constants.ACTION_COPY_NOTE_USERNAME:this.copyNoteField("Username");break;case Constants.ACTION_COPY_NOTE_PASSWORD:this.copyNoteField("Password");break;default:AccountBase.prototype.handleClickEvent.apply(this,arguments)}},Note.prototype.fill=function(t){var e,a;parent.reduxApp&&parent.reduxApp.dropdownFill&&bg.get("LPContentScriptFeatures").web_client_fill?parent.reduxApp.dropdownFill(this.getID()):(a=e="",t&&t.source&&(e=t.source),t&&t.approach&&(a=t.approach),this.passwordProtect(function(){bg.fillNoteFromDropdown(this.getID(),e,a)}))},Note.prototype.copyNote=(x=function(){g.copyToClipboard(this.getNoteField("Notes")),bg.loglogin(this.getID())},function(){this.passwordProtect(x)}),Note.prototype.copyNoteField=function(t){this.passwordProtect(function(){g.copyToClipboard(this.getNoteField(t)),bg.loglogin(this.getID())})},Note.prototype.copyPhoneNumber=(Y=function(){g.copyToClipboard(JSON.parse(this.getNoteField("Phone")).num)},function(){this.passwordProtect(Y)}),Note.prototype.copyPrivateKey=(K=function(t){var t=this.getPrivateKey(t.extra);if(-1===t.indexOf("-----BEGIN")&&-1===t.indexOf("END-----"))g.copyToClipboard(t);else{for(var e=t.split(/-----BEGIN.*KEY-----|-----END.*KEY-----/),t=t.split(/-----/),a=e[1],o="",r=0,s=a.length;r<s;++r)":"!==a.charAt(r-1)?o+=a[r].replace(/\u0020/g,"\n"):o+=a[r];var e="-----"+t[1]+"-----\n"+o+"\n-----"+t[3]+"-----";g.copyToClipboard(e)}bg.loglogin(this.getID())},function(t){var e=this;this.passwordProtect(function(){K.call(e,t)})}),Note.prototype.getNoteField=function(t,e){var a=this.getKeyValuePairs(e),o;for(o in a){var r=a[o];if(o===t&&""!==r)return r}return null},Note.prototype.getPassword=function(){return this.getNoteField("Password")},Note.prototype.hasPassword=function(){return null!==this.getPassword()},Note.prototype.getUsername=function(){return this.getNoteField("Username")},Note.prototype.hasUsername=function(){return null!==this.getUsername()},Note.prototype.getPrivateKey=function(t){return this.getNoteField("Private Key",t)},Note.prototype.hasPrivateKey=function(){return null!==this.getPrivateKey()},Note.prototype.hasNoteField=function(t){return null!==this.getNoteField(t)},Note.prototype.toString=function(){if(LPFeatures.allowOmarIA()){if(!this._displayName)for(var t=bg.get("RecordTypeConfig"),e=0,a;e<t.types.length;++e){if(t.types[e].recordType===this.getRecordType()){this._displayName=Strings.translateString(t.types[e].name)+": "+this._data.name;break}}return this._displayName}return Strings.Vault.SECURE_NOTE+": "+this._data.name},Note.prototype.getKeyValuePairs=(C="NoteType:",function(t){var e=g.decryptMobile(this._data.extra,!0,this.getKey()),a=new DialogInput.NestedFields,o=0===e.indexOf(C),r=!this._noteType||"Generic"!==this._noteType;if(e&&o&&r&&R(e.substring(C.length,e.indexOf("\n"))))for(var s,e,n={},i=0,p=(e=e.split("\n")).length;i<p;++i){var c=e[i],u=c.indexOf(":");if(0<u){var l=c.substring(0,u);if(void 0===n[l]&&("object"!=typeof t||t[l])){a[l]=c.substring(u+1),n[s=l]=!0;continue}}s&&(a[s]+="\n"+c)}else a.Notes=e;return a}),Note.prototype.getFormData=function(t){var e=VaultItem.prototype.getFormData.apply(this,arguments);return e.extra=this.getKeyValuePairs(t.extra),e.notetype=this.getNoteType(),e.template=this._data.template,e},Note.prototype.processEnteredData=function(t,e,a){AccountBase.prototype.processEnteredData.apply(this,arguments);var o="";if(t.notetype!==this.NOTE_TYPES.GENERIC){o="NoteType:"+t.notetype,LPFeatures.allowOmarIA()&&(o+="\nLanguage:"+(t.language||"en-US"));var r=t.extra,s;for(s in r)"function"!=typeof r[s]&&(o+="\n"+s+":"+r[s])}else o=t.extra.Notes;if(t.extra=this.encryptIfNecessary("extra",o,a),this.getKey()!==a&&(t.attachkey=g.encrypt(g.decrypt(this._data.attachkey,this.getKey()),a)),t.attacharraychanges&&t.attacharraychanges.add&&0<t.attacharraychanges.add.length){var n=this.getAttachmentKey(),i=null,p="";if(null===n)n=bg.SHA256(bg.lpCreatePass(32,1,1,1,1,1,1,1)),t.attachkey=g.encrypt(n,a),n=bg.AES.hex2bin(n),i=t.attachkey,p="first_";else if(!n)throw new AttachmentKeyException;this.debugAttachmentKey(p+"attachment_key_uploading",t.storageKey,i);for(var c=0,u=t.attacharraychanges.add.length;c<u;++c){var l=t.attacharraychanges.add[c],d=this.getID();"0"!==d&&(l.id=d+"-"+l.id,l.parent=d),l.filename=g.encrypt(l.filename,n)}}},Note.prototype.getPostData=(q=function(t,e){if(e.attacharraychanges&&e.attacharraychanges.remove)for(var a=0,o=e.attacharraychanges.remove.length;a<o;++a)t["rmattach"+a]=e.attacharraychanges.remove[a]},W=function(t,e){if(e.attacharraychanges&&e.attacharraychanges.add)for(var a=0,o=e.attacharraychanges.add.length;a<o;++a){var r=e.attacharraychanges.add[a];t["filename"+a]=r.filename,t["mimetype"+a]=r.mimetype,t["attachid"+a]=r.id.substring(r.id.indexOf("-")+1),t["attachbytes"+a]=r.bytes}},function(t){var e=AccountBase.prototype.getPostData.apply(this,arguments);return e.url=bg.AES.url2hex(this._data.url),e.u=e.url,e.username="",e.password="",e.template=t.template,e.hexName=bg.AES.url2hex(t.name),e.notetype=t.notetype,t.attachkey&&(e.attachkey=t.attachkey),q(e,t),W(e,t),e}),Note.prototype.update=(H=function(t){if(t&&t.remove)for(var e=0,a=t.remove.length;e<a;++e)this.removeAttachment(t.remove[e])},j=function(t){if(t&&t.add)for(var e=0,a=t.add.length;e<a;++e)this.addAttachment(new Attachment(t.add[e]))},function(t,e,a){t&&t.attacharraychanges&&(a=JSON.parse(JSON.stringify(t.attacharraychanges))),AccountBase.prototype.update.apply(this,arguments),g.refreshSites(),H.call(this,a),j.call(this,a),t.attachpresent=0<this._attachments.length?"1":"",t.attacharraychanges={add:[],remove:[]}}),Note.prototype.add=function(a,t){var o,r;r=(o=this)._data.attacharraychanges,LPRequest.makeUpdateRequest(g.addNote,{parameters:[o,a,t],showTimeWarningTimeout:5e4,noDefaultMessage:!0,success:function(t){var e=null!=r?JSON.parse(JSON.stringify(r)):r;o.update(t,a,e),o.publishAdd(Topics.NOTE_ADDED,a)},error:function(){LPPlatform.logError("When sends the save request to the LPProxy to add note."),Topics.get(Topics.ERROR).publish(Strings.translateString("Changes to your note couldn't be saved. Try again."))}})},Note.prototype.save=function(e,a,t){var o=this;LPRequest.makeUpdateRequest(g.saveNote,{parameters:[o,e,a,t],showTimeWarningTimeout:5e4,noDefaultMessage:!0,success:function(t){o.update(t,a,e.attacharraychanges),o.publishSaveSuccess(1)},error:function(){LPPlatform.logError("When sends the save request to the LPProxy to modify note."),Topics.get(Topics.ERROR).publish(Strings.translateString("Changes to your note couldn't be saved. Try again."))}})},Note.prototype.hasAttachments=function(){return 0<this._attachments.length},Note.prototype.getAttachments=function(){return this._attachments},Note.prototype.addAttachment=function(t){t.setParentNote(this),this._attachments.push(t)},Note.prototype.removeAttachment=function(t){for(var e=0,a=this._attachments.length;e<a;++e)if(this._attachments[e]===t||this._attachments[e].getID()===t)return void this._attachments.splice(e,1)},Attachment.prototype.setParentNote=function(t){(this._parentNote=t)&&(this._data.parent=t.getID())},Attachment.prototype.getID=function(){return this._data.id},Attachment.prototype.getName=function(){var t,e,t;return null===this._filename&&(null!==this._data.filename&&this._data.filename.length?(t=this._parentNote?this._parentNote.getAttachmentKey():null)&&(this._filename=g.decrypt(this._data.filename,t)):(t="",0===(e=this._data.mimetype).indexOf("other:")?t="."+e.substring(6):0!==e.indexOf("data:audio")&&0!==e.indexOf("data:image")||(t="."+e.substring(11)),this._filename="attachment"+t)),this._filename||this._data.filename},Attachment.prototype.getType=function(){return this._data.mimetype},Attachment.prototype.getBytes=function(){return this._data.bytes},Attachment.prototype.getStorageKey=function(){return this._data.storagekey},Attachment.prototype.getParentNote=function(){return this._parentNote},Attachment.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_DOWNLOAD:bg.sendLpImprove("download_attachment_clicked",{source:LPPlatform.lpIsExtension()?"extension":"webvault",usingbinary:"0"}),this.download();break;case Constants.ACTION_DELETE:bg.sendLpImprove("delete_attachment_clicked",{source:LPPlatform.lpIsExtension()?"extension":"webvault",usingbinary:"0"}),VaultItemBase.prototype.handleClickEvent.apply(this,arguments);break;default:VaultItemBase.prototype.handleClickEvent.apply(this,arguments)}},Attachment.prototype.download=function(){LPPlatform.downloadAttachment(this)},Attachment.prototype.deleteItem=function(){Topics.get(Topics.ATTACHMENT_REMOVED).publish(this),this.destroyViews()},Attachment.prototype.toString=function(){return Strings.Vault.DOWNLOAD+" "+this.getName()},FormFill.prototype.REPROMPT_TYPE="view_ff_prompt",FormFill.prototype.FORM_FILL_TYPE_GENERIC="0",FormFill.prototype.FORM_FILL_TYPE_CREDIT_CARD="1",FormFill.prototype.getRepromptType=function(){return this.REPROMPT_TYPE},FormFill.prototype.getEditTopicID=function(){return Topics.EDIT_FORM_FILL},FormFill.prototype.getName=function(){return this._data.decprofilename},FormFill.prototype.getID=function(){return this._data.ffid},FormFill.prototype.setID=function(t){this._data.ffid=t},FormFill.prototype.isCreditCard=function(){return this._data.profiletype===this.FORM_FILL_TYPE_CREDIT_CARD},FormFill.prototype.toString=function(){return Strings.Vault.FORM_FILL+": "+this._data.decprofilename},FormFill.prototype.handleClickEvent=function(t,e){t===Constants.ACTION_FILL?this.fill(e):VaultItem.prototype.handleClickEvent.apply(this,arguments)},FormFill.prototype.fill=function(t){var t=t?t.source:"vault";g.fillProfile(this,t)},FormFill.prototype.deleteItem=function(t){var e;this.passwordProtect((e=this,function(){LPRequest.makeLockItemUpdateRequest(g.deleteFormFill,{parameters:[e,t],items:e,success:function(){e.deleteUpdates()},confirm:e.confirmDelete()})}))},FormFill.prototype.enableCreditMonitoring=function(){LPRequest.makeUpdateRequest(g.createCreditMonitoringProfile,{parameters:this})},FormFill.prototype.add=function(t,e){var a;a=this,LPRequest.makeUpdateRequest(g.addFormFill,{parameters:[a,e],success:function(t){a.update(t),a._data.creditmon&&a.enableCreditMonitoring(),a.publishAdd(Topics.FORM_FILL_ADDED)},confirm:a._data.creditmon?O(a._data,a.getKey()):null})},F=function(t,e,a){var o=h.createElement("tr","settingsRow"),e;o.appendChild(h.createElement("td","settingLabel",e)),"string"==typeof a?o.appendChild(h.createElement("td",null,a)):((e=h.createElement("td")).appendChild(a),o.appendChild(e)),t.appendChild(o)},z=function(t,e){var a=h.createElement("div");return t.address1&&a.appendChild(h.createElement("p",null,g.decryptMobile(t.address1,!0,e))),t.address2&&a.appendChild(h.createElement("p",null,g.decryptMobile(t.address2,!0,e))),t.address3&&a.appendChild(h.createElement("p",null,g.decryptMobile(t.address3,!0,e))),a.appendChild(h.createElement("p",null,g.decryptMobile(t.city,!0,e)+", "+g.decryptMobile(t.state,!0,e)+" "+g.decryptMobile(t.zip,!0,e))),a},J=function(t){return" "+t.slice(-4)},X=function(t){return"("+(t=11===t.length?t.substring(1):t).substring(0,3)+") "+t.substring(3,6)+"-"+t.substring(6)},O=function(t,e){var a=[Strings.translateString("Only the below information will be sent to LastPass."),Strings.translateString("Other confidential Form Fill information, such as credit card numbers, will not be sent.")],o=h.createElement("table","settings creditMonConfirm"),t=(F(o,Strings.translateString("Name"),g.decryptMobile(t.firstname,!0,e)+" "+g.decryptMobile(t.lastname,!0,e)),F(o,Strings.translateString("Birthday"),g.decryptMobile(t.birthday,!0,e)),F(o,Strings.translateString("Social Security Number"),J(g.decryptMobile(t.ssn,!0,e))),F(o,Strings.translateString("Phone Number"),X(g.decryptMobile(t.phone,!0,e))),F(o,Strings.translateString("Address"),z(t,e)),h.addZebraStriping(o),a.push(o),h.createElement("p",{compoundtranslation:!0,class:"dialogText"},"I have read and agree with the "));return t.appendChild(h.createElement("a",{target:"_blank",href:g.getBaseURL()+"creditmonitoring.php?cmd=showterms"},"LastPass Terms and Conditions")),Strings.translate(t),a.push(t),{title:Strings.Vault.ADD_CREDIT_MON,text:a,nextButtonText:Strings.translateString("I Agree"),backButtonText:Strings.translateString("I Do Not Agree")}},FormFill.prototype.save=function(t,e,a){var o;o=this,LPRequest.makeUpdateRequest(g.saveFormFill,{parameters:[o,t,a],success:function(){o.update(t),o.publishSaveSuccess(1)},confirm:t.creditmon&&!o._data.creditmon?O(t,o.getKey()):null})},FormFill.prototype.update=function(t){var e=!1;t.creditmon&&!this._data.creditmon&&(e=!0),VaultItem.prototype.update.apply(this,arguments),e&&this.enableCreditMonitoring()},FormFill.prototype.getPostData=function(t){var e=VaultItem.prototype.getPostData.apply(this,arguments),a=this.getKey(),o;for(o in t){var r=t[o];if(this.isEncryptedField(o))e[o]=g.encryptWithKey(g.decryptMobile(r,!0,a),a);else switch(o){case"creditmon":case"pwprotect":break;default:e[o]=r}}return e.ffid=this.getID(),void 0!==e.custom_fields&&delete e.custom_fields,t.creditmon&&(e.creditmon="on"),e},FormFill.prototype.isEncryptedField=function(t){if(-1!==t.indexOf("cfid"))return!1;switch(t){case"decprofilename":case"pwprotect":case"creditmon":case"custom_fields":case"profiletype":return!1;default:return!0}},k=function(t,e){try{var a=JSON.parse(t[e]);delete t[e],t[e+"ext"]=a.ext,t["phone"===e||"fax"===e?e:e+"phone"]=a.num,t["phone"===e||"fax"===e?e+"3lcc":e+"phone3lcc"]=a.cc3l}catch(t){}},w=function(t,e,a){var o={};return o.ext=g.decryptMobile(t[e+"ext"],!0,a),o.num=g.decryptMobile(t["phone"===e||"fax"===e?e:e+"phone"],!0,a),o.cc3l=g.decryptMobile(t["phone"===e||"fax"===e?e+"3lcc":e+"phone3lcc"],!0,a),JSON.stringify(o)},FormFill.prototype.processEnteredData=function(t,e,a){for(var o in k(t,"phone"),k(t,"mobile"),k(t,"eve"),k(t,"fax"),t){var r=t[o];if("custom_fields"===o)for(var s="customfield",n=0,i=r.length;n<i;++n){var p=r[n],c=s+(n+1);t[c+"cfid"]=p.cfid,t[c+"text"]=g.encryptMobile(p.text,!0,a),t[c+"value"]=g.encryptMobile(p.value,!0,a),t[c+"alttext"]=""}else this.isEncryptedField(o)&&(t[o]=this.encryptIfNecessary(o,t[o],a))}delete t.custom_fields,t.profilename=g.encryptMobile(t.decprofilename,!0,a)},FormFill.prototype.getFormData=function(t){var e={},a=this.getKey(),o;for(o in t)this.isEncryptedField(o)?e[o]=g.decryptMobile(this._data[o],!0,a):e[o]=this._data[o];if(t.custom_fields){e.custom_fields=[];for(var r=0,s=this._data.custom_fields.length;r<s;++r){var n=this._data.custom_fields[r],i={},n=(i.cfid=n.cfid,i.text=g.decryptMobile(n.text,!0,a),i.value=g.decryptMobile(n.value,!0,a),g.decryptMobile(n.alttext,!0,a));""!==n&&(i.value+="\n"+n),e.custom_fields.push(i)}}return e.phone=w(this._data,"phone",a),e.mobile=w(this._data,"mobile",a),e.eve=w(this._data,"eve",a),e.fax=w(this._data,"fax",a),e},Identity.prototype.REPROMPT_TYPE="switch_identity_prompt",Identity.prototype.getRepromptType=function(){return this.REPROMPT_TYPE},Identity.prototype.getName=function(){return this._data.deciname},Identity.prototype.getID=function(){return this._data.iid},Identity.prototype.setID=function(t){this._data.iid=t},Identity.prototype.handleClickEvent=function(t,e){t===Constants.ACTION_ENABLE?this.enable():VaultItemBase.prototype.handleClickEvent.apply(this,arguments)},Identity.prototype.getEditTopicID=function(t){return Topics.EDIT_IDENTITY},Identity.prototype.enable=(L=function(){Topics.get(Topics.IDENTITY_ENABLE).publish(this),this._enabled=!0,this.updateViews()},function(t){h.getOption(t,"reprompt",!0)?this.passwordProtect(function(){L.apply(this),t&&t.callback&&t.callback()}):L.apply(this)}),Identity.prototype.disable=function(){this._enabled=!1,this.updateViews()},Identity.prototype.processEnteredData=function(t,e,a){t.iname=g.encryptAES(t.deciname,a)},Identity.prototype.save=($=function(t){this.update(t),this.publishSaveSuccess(1)},function(t){LPRequest.makeUpdateRequest(g.saveIdentity,{params:{identity:t},success:this.createHandler($)})}),Identity.prototype.add=(Z=function(t){this.update(t),this.publishAdd(Topics.IDENTITY_ADDED)},function(){LPRequest.makeUpdateRequest(g.addIdentity,{params:{identity:this._data},success:this.createHandler(Z)})}),Identity.prototype.deleteItem=(Q=function(){this.deleteUpdates()},tt=function(){g.logEvent("v_did"),LPRequest.makeLockItemUpdateRequest(g.deleteIdentity,{params:{id:this.getID()},items:this,success:this.createHandler(Q),confirm:this.confirmDelete()})},function(){this._enabled?Topics.get(Topics.ERROR).publish(Strings.translateString("%s cannot be deleted while enabled.",this.toString())):this.passwordProtect(tt)}),Identity.prototype.toString=function(){return Strings.Vault.IDENTITY+": "+this.getName()}}($,document,LPTools,LPProxy);